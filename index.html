<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Booth</title>
    <style>
        /* ... giữ nguyên toàn bộ phần style như bạn đã gửi ... */
    </style>
</head>
<body>
    <!-- ... giữ nguyên phần HTML như bạn đã gửi ... -->
    <!-- Nút Back, Fullscreen ... -->
    <div class="sidebar-actions">
        <!-- ... -->
    </div>
    <div class="side-bar">
        <!-- ... -->
    </div>
    <div class="main-view">
        <div class="video-wrap">
            <video id="video" autoplay playsinline></video>
            <canvas id="capture-canvas" style="display:none;"></canvas>
            <div id="burst-countdown" class="burst-countdown"></div>
        </div>
        <div class="zoom-panel" style="position:absolute;bottom:70px;left:50%;transform:translateX(-50%);">
            <!-- ... -->
        </div>
        <div class="controls-panel" style="position:absolute;bottom:15px;left:50%;transform:translateX(-50%);">
            <!-- ... -->
        </div>
    </div>
    <div class="right-bar">
        <!-- ... -->
    </div>
    <!-- Bottom gradient bar & buttons -->
    <div class="bottom-bar">
        <button class="bar-btn" id="btn-mode-1">
            <span class="bar-btn-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2"/>
                </svg>
            </span>
            Chụp từng kiểu 1/4
        </button>
        <button class="bar-btn" id="btn-mode-2">
            <span class="bar-btn-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <rect x="4" y="8" width="16" height="8" rx="4" stroke="currentColor" stroke-width="2"/>
                    <rect x="8" y="4" width="8" height="16" rx="4" stroke="currentColor" stroke-width="2"/>
                </svg>
            </span>
            Chụp liên tiếp
        </button>
        <button class="heart-btn" title="Yêu thích">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                <path d="M12 21s-6.486-4.689-9-7.931C-1.314 9.09 2.266 4 7.012 4c1.957 0 3.872 1.167 4.988 3.003C13.116 5.167 15.031 4 16.988 4c4.746 0 8.326 5.09 4.012 9.069C18.486 16.311 12 21 12 21z" stroke="currentColor" stroke-width="2"/>
            </svg>
        </button>
    </div>
    <script>
        // ... giữ nguyên các biến, hàm, logic như bạn đã gửi ở trên ...

        // Hàm chụp vào đúng index
        function captureToIndex(idx) {
            if (idx < 0 || idx > 3) return;
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.save();
            if (usingFront) {
                ctx.translate(canvas.width, 0);
                ctx.scale(-1,1);
            }
            ctx.filter =
                `grayscale(${sliders.grayscale.value}) brightness(${sliders.brightness.value}) sepia(${sliders.sepia.value}) blur(${sliders.blur.value}px) hue-rotate(${sliders.hue.value * 90}deg)`;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            ctx.restore();
            addNoise(ctx, canvas.width, canvas.height, parseFloat(sliders.noise.value));
            const dataURL = canvas.toDataURL('image/jpeg');
            capturedImages[idx] = dataURL;
            renderCapturedList();
        }

        // Chụp từng kiểu 1/4 với đếm ngược 3 giây cho từng kiểu
        const singleBtn = document.getElementById('btn-mode-1');
        singleBtn.onclick = async () => {
            singleBtn.disabled = true;
            for (let i = 0; i < 4; i++) {
                if (capturedImages[i]) continue;
                for (let t = 3; t > 0; t--) {
                    burstCountdown.innerText = t;
                    burstCountdown.style.display = 'block';
                    await new Promise(res => setTimeout(res, 700));
                }
                burstCountdown.style.display = 'none';
                await new Promise(res => {
                    setTimeout(() => {
                        captureToIndex(i);
                        res();
                    }, 250);
                });
            }
            singleBtn.disabled = false;
        };

        // Chụp liên tiếp như cũ
        const burstBtn = document.getElementById('btn-mode-2');
        burstBtn.onclick = async () => {
            burstBtn.disabled = true;
            let total = 4, interval = 2300;
            for(let i=0; i<total; i++) {
                for(let t=3; t>0; t--) {
                    burstCountdown.innerText = t;
                    burstCountdown.style.display = 'block';
                    await new Promise(res => setTimeout(res, 700));
                }
                burstCountdown.style.display = 'none';
                await new Promise(res => {
                    setTimeout(() => {
                        captureBtn.click();
                        res();
                    }, 250);
                });
                if (i < total - 1) await new Promise(res => setTimeout(res, interval - 1000*3));
            }
            burstBtn.disabled = false;
        };

        // ... các phần còn lại giữ nguyên ...
    </script>
</body>
</html>
